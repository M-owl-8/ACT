╔════════════════════════════════════════════════════════════════════════════╗
║                   🔥 502 ERROR - ROOT CAUSE FOUND & FIXED! 🔥              ║
╚════════════════════════════════════════════════════════════════════════════╝

THE ROOT CAUSE:
───────────────
Your app was connecting to PRODUCTION (Railway) instead of LOCAL backend!

  ❌ BEFORE:
     App says:    "I'll connect to https://act-production-8080.up.railway.app"
     Backend says: "I'm only listening on 127.0.0.1 (localhost only)"
     Result:       502 Bad Gateway (nothing connects!)

  ✅ AFTER (JUST FIXED):
     App now says:   "I'll connect to http://10.0.2.2:8000"
     Backend now:    "I'm listening on 0.0.0.0 (all interfaces!)"
     Result:         ✅ WORKS!


WHAT I FIXED:
─────────────
1. ✅ Changed backend startup command (→ --host 0.0.0.0)
2. ✅ Changed .env file (→ http://10.0.2.2:8000)
3. ✅ Created helper scripts


HOW TO FIX IT RIGHT NOW:
───────────────────────

OPTION A: FULLY AUTOMATED (EASIEST)
═════════════════════════════════════

Terminal 1 - Start Backend:
  cd c:\Users\user\Desktop\Bitway\Programs\act-gen1
  .\FIX_502_FINAL_PERMANENT.ps1

Terminal 2 - Start Mobile App (after backend is ready):
  cd c:\Users\user\Desktop\Bitway\Programs\act-gen1\apps\mobile
  npm start -- --reset-cache
  (Press 'a' for Android)


OPTION B: MANUAL (IF YOU PREFER)
═════════════════════════════════

Terminal 1 - Backend:
  cd c:\Users\user\Desktop\Bitway\Programs\act-gen1\apps\api
  .\.venv\Scripts\Activate.ps1
  uvicorn main:app --reload --host 0.0.0.0 --port 8000

Terminal 2 - App:
  cd c:\Users\user\Desktop\Bitway\Programs\act-gen1\apps\mobile
  npm start -- --reset-cache
  (Press 'a' for Android)


VERIFY IT WORKS:
────────────────

Check Backend:
  • Open: http://localhost:8000/docs in browser
  • Should see API documentation ✅

Check App:
  • Look at app logs for: "API Base URL: http://10.0.2.2:8000"
  • Should NOT show production URL ✅

Test Registration:
  • Try to register a user
  • Should work WITHOUT 502 error ✅


WHY THIS WORKS:
────────────────

Android Emulator Networking:
  Windows Computer          Android Emulator
  ───────────────          ─────────────────
  localhost:8000  ──→  http://10.0.2.2:8000
  127.0.0.1:8000  ──→  (same magic address)

The emulator CANNOT access 127.0.0.1 directly.
It uses special address 10.0.2.2 to reach host.
Backend must listen on 0.0.0.0 to accept from ALL addresses.


KEY CHANGES MADE:
──────────────────

File: .env
  FROM: EXPO_PUBLIC_API_BASE_URL=https://act-production-8080.up.railway.app
  TO:   EXPO_PUBLIC_API_BASE_URL=http://10.0.2.2:8000

File: Backend Startup
  FROM: uvicorn main:app --reload --port 8000
  TO:   uvicorn main:app --reload --host 0.0.0.0 --port 8000


IMPORTANT NOTES:
─────────────────
1. You MUST clear metro cache: npm start -- --reset-cache
2. You MUST restart the app (not just hot reload)
3. The .env change requires a full app restart to take effect
4. Backend must be running BEFORE you start the app
5. Keep both terminals open - don't close them


TROUBLESHOOTING:
─────────────────

Q: Still getting 502?
A: 1. Stop everything (Ctrl+C)
   2. Check .env contains: EXPO_PUBLIC_API_BASE_URL=http://10.0.2.2:8000
   3. Run: npm start -- --reset-cache
   4. Check app logs show: "API Base URL: http://10.0.2.2:8000"

Q: "Address already in use" on port 8000?
A: Run: .\FIX_502_FINAL_PERMANENT.ps1 (auto-clears port)

Q: Metro bundler keeps crashing?
A: Run: npm start -- --reset-cache (clears cached files)

Q: Still showing production URL?
A: You didn't clear the cache properly. Run:
   npm start -- --reset-cache
   Don't use npm start alone!


DEPLOYMENT REMINDER:
──────────────────────
When you deploy to production, change .env to:
  EXPO_PUBLIC_API_BASE_URL=https://act-production-8080.up.railway.app

For now, leave it as:
  EXPO_PUBLIC_API_BASE_URL=http://10.0.2.2:8000


NEXT STEPS:
────────────
1. Run Option A or B above
2. Verify registration works
3. Test your app features
4. If working, you're done! 🎉


📞 NEED HELP?
───────────────
Read: FIX_502_ROOT_CAUSE_FOUND.md (full explanation)
View: START_BACKEND_FIXED.ps1 (backend startup)
Check: FIX_502_FINAL_PERMANENT.ps1 (automated fix)


Good luck! You've got this! 🚀