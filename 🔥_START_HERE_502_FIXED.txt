â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   ğŸ”¥ 502 ERROR - ROOT CAUSE FOUND & FIXED! ğŸ”¥              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

THE ROOT CAUSE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Your app was connecting to PRODUCTION (Railway) instead of LOCAL backend!

  âŒ BEFORE:
     App says:    "I'll connect to https://act-production-8080.up.railway.app"
     Backend says: "I'm only listening on 127.0.0.1 (localhost only)"
     Result:       502 Bad Gateway (nothing connects!)

  âœ… AFTER (JUST FIXED):
     App now says:   "I'll connect to http://10.0.2.2:8000"
     Backend now:    "I'm listening on 0.0.0.0 (all interfaces!)"
     Result:         âœ… WORKS!


WHAT I FIXED:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. âœ… Changed backend startup command (â†’ --host 0.0.0.0)
2. âœ… Changed .env file (â†’ http://10.0.2.2:8000)
3. âœ… Created helper scripts


HOW TO FIX IT RIGHT NOW:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

OPTION A: FULLY AUTOMATED (EASIEST)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Terminal 1 - Start Backend:
  cd c:\Users\user\Desktop\Bitway\Programs\act-gen1
  .\FIX_502_FINAL_PERMANENT.ps1

Terminal 2 - Start Mobile App (after backend is ready):
  cd c:\Users\user\Desktop\Bitway\Programs\act-gen1\apps\mobile
  npm start -- --reset-cache
  (Press 'a' for Android)


OPTION B: MANUAL (IF YOU PREFER)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Terminal 1 - Backend:
  cd c:\Users\user\Desktop\Bitway\Programs\act-gen1\apps\api
  .\.venv\Scripts\Activate.ps1
  uvicorn main:app --reload --host 0.0.0.0 --port 8000

Terminal 2 - App:
  cd c:\Users\user\Desktop\Bitway\Programs\act-gen1\apps\mobile
  npm start -- --reset-cache
  (Press 'a' for Android)


VERIFY IT WORKS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Check Backend:
  â€¢ Open: http://localhost:8000/docs in browser
  â€¢ Should see API documentation âœ…

Check App:
  â€¢ Look at app logs for: "API Base URL: http://10.0.2.2:8000"
  â€¢ Should NOT show production URL âœ…

Test Registration:
  â€¢ Try to register a user
  â€¢ Should work WITHOUT 502 error âœ…


WHY THIS WORKS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Android Emulator Networking:
  Windows Computer          Android Emulator
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  localhost:8000  â”€â”€â†’  http://10.0.2.2:8000
  127.0.0.1:8000  â”€â”€â†’  (same magic address)

The emulator CANNOT access 127.0.0.1 directly.
It uses special address 10.0.2.2 to reach host.
Backend must listen on 0.0.0.0 to accept from ALL addresses.


KEY CHANGES MADE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

File: .env
  FROM: EXPO_PUBLIC_API_BASE_URL=https://act-production-8080.up.railway.app
  TO:   EXPO_PUBLIC_API_BASE_URL=http://10.0.2.2:8000

File: Backend Startup
  FROM: uvicorn main:app --reload --port 8000
  TO:   uvicorn main:app --reload --host 0.0.0.0 --port 8000


IMPORTANT NOTES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. You MUST clear metro cache: npm start -- --reset-cache
2. You MUST restart the app (not just hot reload)
3. The .env change requires a full app restart to take effect
4. Backend must be running BEFORE you start the app
5. Keep both terminals open - don't close them


TROUBLESHOOTING:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Q: Still getting 502?
A: 1. Stop everything (Ctrl+C)
   2. Check .env contains: EXPO_PUBLIC_API_BASE_URL=http://10.0.2.2:8000
   3. Run: npm start -- --reset-cache
   4. Check app logs show: "API Base URL: http://10.0.2.2:8000"

Q: "Address already in use" on port 8000?
A: Run: .\FIX_502_FINAL_PERMANENT.ps1 (auto-clears port)

Q: Metro bundler keeps crashing?
A: Run: npm start -- --reset-cache (clears cached files)

Q: Still showing production URL?
A: You didn't clear the cache properly. Run:
   npm start -- --reset-cache
   Don't use npm start alone!


DEPLOYMENT REMINDER:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
When you deploy to production, change .env to:
  EXPO_PUBLIC_API_BASE_URL=https://act-production-8080.up.railway.app

For now, leave it as:
  EXPO_PUBLIC_API_BASE_URL=http://10.0.2.2:8000


NEXT STEPS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Run Option A or B above
2. Verify registration works
3. Test your app features
4. If working, you're done! ğŸ‰


ğŸ“ NEED HELP?
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Read: FIX_502_ROOT_CAUSE_FOUND.md (full explanation)
View: START_BACKEND_FIXED.ps1 (backend startup)
Check: FIX_502_FINAL_PERMANENT.ps1 (automated fix)


Good luck! You've got this! ğŸš€